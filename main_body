import numpy as np
import matplotlib.pyplot as plt
import matplotlib.gridspec as gridspec

while True:
    end = ""
    print("Welcome to financial analysis. This project will help you to visualise financial data. You can choose to compare historical data over a number of accounting periods (horizontal analysis) or analyse single reporting period (vertical analysis)")
    select_menu = int(input("Please enter 1 (vertical analysis) or 2 (horizontal analysis)"))
    if select_menu in [1, 2]:
        if select_menu == 1:
        
        #Objective-oriented programming
            class Year1:
                def __init__(self, rev, cogs, assets, liab, equity, net):
                    self.rev = input("Revenues")
                    self.cogs = input("Costs of goods")
                    self.assets = input("Total assets")
                    self.liab = input("Total liabilities")
                    self.equity = input("Equity")
                    self.net = input("Net income")

                def text():
                    print('Enter first period data')


            class Year2(Year1):

                def __init__(self, rev, cogs, asetss, liab, equity, net):
                    super().__init__(rev, cogs, asetss, liab, equity, net)

                def text():
                    print('Enter second period data')


            class Year3(Year1):

                def __init__(self, rev, cogs, assets, liab, equity, net):
                    super().__init__(rev, cogs, assets, liab, equity, net)

                def text():
                    print('Enter third period data')


            class Year4(Year1):

                def __init__(self, rev, cogs, assets, liab, equity, net):
                    super().__init__(rev, cogs, assets, liab, equity, net)

                def text():
                    print('Enter 4th period data')

#under development. Target: to identify delta between values and diferiancate color of text according to output
```       
            class Features:
                def Delta_1_year(self, delta):
                    self.delta = (int(year2.rev) - int(year1.rev)) / int(year1.rev) * 100
                    return round(self.delta, 2)

                def Color_change():
                    if self.delta < 0:
                        Colo = 'r'
                    elif self.delta > 0:
                        Colo = 'g' 
```


            while end not in ("Q", "q"):
                print("Enter number of comparative periods\n 2 year\n 3 year\n 4 year")
                select_H_Main = int(input("Please enter"))
                if select_H_Main == 2:
                    Year1.text()
                    year1 = Year1(1, 2, 3, 4, 5, 6)
                    Year2.text()
                    year2 = Year2(1, 2, 3, 4, 5, 6)

                    while end not in ("Q", "q"):
                        print("please select\n 1 - revenues\n 2 - cogs\n 3 - assets\n 4 - liabilities\n 5 - equity\n 6 - net income")
                        select_H_2 = int(input("Please enter selection"))
                        if select_H_2 == 1:
                            def Delta_1_year():
                                delta = (int(year2.rev) - int(year1.rev)) / int(year1.rev) * 100
                                return round(delta, 2)

                            plt.style.use("bmh")  # revenue
                            x_axis = np.arange(1, 3)
                            labels = [int(year1.rev), int(year2.rev)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.rev) + .25, str(Delta_1_year()) + '%', color=Colo) 
                            #Under development. Associated with Delta and Color_change f-tions.
                            plt.xlabel('Periods')
                            plt.ylabel('Revenue')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_2 == 2:  # cogs
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 3)
                            labels = [int(year1.cogs), int(year2.cogs)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.cogs) + .25, str(Delta_1_year()) + '%', color=Colo)
                             #Under development. Associated with Delta and Color_change f-tions.
                            plt.xlabel('Periods')
                            plt.ylabel('Costs of goods')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_2 == 3:  # assets
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 3)
                            labels = [int(year1.assets), int(year2.assets)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.assets) + .25, str(Delta_1_year()) + '%', color=Colo)
                            #Under development. Associated with Delta and Color_change f-tions.
                            plt.xlabel('Periods')
                            plt.ylabel('Assets')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_2 == 4:  # liabilities
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 3)
                            labels = [int(year1.liab), int(year2.liab)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            #plt.text(2, int(year2.liab) + .25, str(Delta_1_year()) + '%', color=Colo)
                            #Under development. Associated with Delta and Color_change f-tions.
                            plt.xlabel('Periods')
                            plt.ylabel('Liabilities')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_2 == 5:  # equity
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 3)
                            labels = [int(year1.equity), int(year2.equity)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.equity) + .25, str(Delta_1_year()) + '%', color=Colo)
                             #Under development. Associated with Delta and Color_change f-tions.
                            plt.xlabel('Periods')
                            plt.ylabel('Equity')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_2 == 6:  # income
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 3)
                            labels = [int(year1.net), int(year2.net)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.net) + .25, str(Delta_1_year()) + '%', color=Colo)
                             #Under development. Associated with Delta and Color_change f-tions.
                            plt.xlabel('Periods')
                            plt.ylabel('Net income')
                            plt.xticks(x_axis, x_axis)
                            plt.show()
                        end = input("Press any key to go back. If you want to quit, please enter ""Q""")
                    else:
                        break

                if select_H_Main == 3:

                    Year1.text()
                    year1 = Year1(1, 2, 3, 4, 5, 6)
                    Year2.text()
                    year2 = Year2(1, 2, 3, 4, 5, 6)
                    Year3.text()
                    year3 = Year3(1, 2, 3, 4, 5, 6)
                    end = input("")

                    while end not in ("Q", "q"):
                        print("please select\n 1 - revenues\n 2 - cogs\n 3 - assets\n 4 - liabilities\n 5 - equity\n 6 - net income")
                        select_H_3 = int(input("Please enter selection"))


                        def Delta_2_year():
                            delta = (int(year2.rev) - int(year1.rev)) / int(year1.rev) * 100
                            return round(delta, 2)


                        if select_H_3 == 1:  # revenues
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 4)
                            labels = [int(year1.rev), int(year2.rev), int(year3.rev)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.cogs) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Revenue')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_3 == 2:  # cogs
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 4)
                            labels = [int(year1.cogs), int(year2.cogs)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.cogs) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Costs of goods')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_3 == 3:  # assets
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 4)
                            labels = [int(year1.assets), int(year2.assets), int(year3.assets)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.liab) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Assets')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_3 == 4:  # liabilities
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 4)
                            labels = [int(year1.liab), int(year2.liab), int(year3.liab), int(year4.liab)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.cogs) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Liabilities')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_3 == 5:  # equity
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 4)
                            labels = [int(year1.equity), int(year2.equity), int(year3.equity), int(year4.equity)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.equity) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Equity')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_3 == 6:  # income
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 4)
                            labels = [int(year1.net), int(year2.net), int(year3.net), int(year4.net)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.assets) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Net income')
                            plt.xticks(x_axis, x_axis)
                            plt.show()
                        end = input("Press any key to go back. If you want to quit, please enter ""Q""")
                    else:
                        break

                if select_H_Main == 4:
                    Year1.text()
                    year1 = Year1(1, 2, 3, 4, 5, 6)
                    Year2.text()
                    year2 = Year2(1, 2, 3, 4, 5, 6)
                    Year3.text()
                    year3 = Year3(1, 2, 3, 4, 5, 6)
                    Year4.text()
                    year4 = Year4(1, 2, 3, 4, 5, 6)

                    while end not in ("Q", "q"):
                        print(
                            "please select\n 1 - revenues\n 2 - cogs\n 3 - assets\n 4 - liabilities\n 5 - equity\n 6 - net income")
                        select_H_4 = int(input("Please enter selection"))


                        def Delta_2_year():
                            delta = (int(year2.rev) - int(year1.rev)) / int(year1.rev) * 100
                            return round(delta, 2)


                        if select_H_4 == 1:  # revenues
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 5)
                            labels = [int(year1.rev), int(year2.rev), int(year3.rev), int(year4.rev)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.cogs) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Revenue')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_4 == 2:  # cogs
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 5)
                            labels = [int(year1.cogs), int(year2.cogs), int(year3.cogs), int(year4.cogs)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.cogs) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Costs of goods')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_4 == 3:  # assets
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 5)
                            labels = [int(year1.assets), int(year2.assets), int(year3.assets), int(year4.assets)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.liab) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Assets')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_4 == 4:  # liabilities
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 5)
                            labels = [int(year1.liab), int(year2.liab), int(year3.liab), int(year4.liab)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.cogs) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Liabilities')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_4 == 5:  # equity
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 5)
                            labels = [int(year1.equity), int(year2.equity), int(year3.equity), int(year4.equity)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.equity) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Equity')
                            plt.xticks(x_axis, x_axis)
                            plt.show()

                        if select_H_4 == 6:  # income
                            plt.style.use("bmh")
                            x_axis = np.arange(1, 5)
                            labels = [int(year1.net), int(year2.net), int(year3.net), int(year4.net)]
                            plt.bar(x_axis, [int(x) for x in labels])
                            # plt.text(2, int(year2.assets) + .25, str(Delta_1_year()) + '%', color=Colo)
                            plt.xlabel('Periods')
                            plt.ylabel('Net income')
                            plt.xticks(x_axis, x_axis)
                            plt.show()
                        end = input("Press any key to go back. If you want to quit, please enter ""Q""")
                    else:
                        break

                end = input("Press any key to go back. If you want to quit, please enter ""Q""")
            else:
                break
        elif select_menu == 2:
        
        #Functional programing
            print('Enter income statement information')
            rev = float(input("Enter revenues"))
            cogs = float(input("Enter costs of goods"))
            ebit = float(input("Enter EBIT/operating profit"))
            net_income = float(input("Enter net income"))

            print("Enter balance sheet information")
            t_receivables = float(input("Enter trades receivables"))
            inventory = float(input("Enter inventory"))
            short_assets = float(input("Enter current assets"))
            tot_assets = float(input("Enter total assets"))
            t_payables = float(input("Enter trades payables"))
            short_liabl = float(input("Enter current liabilities"))
            tot_liabl = float(input("Enter total liabilities"))
            tot_equity = float(input("Enter total equity"))


            # ratios
            def days_sales_outstanding():
                return int(t_receivables / rev * 365)

            def days_payable_outstanding():
                return int(t_payables / cogs * 365)

            def days_inventory_outstanding():
                return int(inventory / cogs * 365)

            def roa_percentage():
                return int(100 * (tot_assets / net_income))

            def roa():
                return int(100 - roa_percentage())

            def operating_profit_percetenge():
                return int(100 * (ebit / rev))

            def operating_profit():
                return int(100 - operating_profit_percetenge())

            def roe_percetange():
                return int(100 * (tot_equity / net_income))

            def roe():
                return int(100 - roe_percetange())

            def current_ratio():
                return int(short_assets / short_liabl)

            # graphics

            def current_ratio_pic():
                plt.xkcd()
                plt.axhline(1, color='r', linestyle='-')
                plt.axhline(3, color="r", linestyle='-')
                plt.text(0.8, 3.1, "Underperformance", fontsize=20)
                plt.text(1, 0.9, "Risk", fontsize=20)
                plt.ylabel("Current ratio")
                plt.xticks([])
                plt.bar(1, current_ratio(), label="Current ratio is {}".format(current_ratio()))
                plt.legend(loc=8)
                plt.show()


            def capital_structure():
                plt.xkcd()
                plt.pie([tot_liabl, tot_equity],
                        labels=["Liabilities", "Equity"],
                        autopct='%1.1f%%',
                        startangle=90,
                        explode=(0, 0.1))
                plt.legend(loc=3)
                plt.title("Capital structure")
                plt.show()


            def cash_conversion_cycle():
                plt.xkcd()
                fig, ax = plt.subplots(1, 1)
                ax.bar(1, days_inventory_outstanding(), label="Inventory")
                ax.bar(1, days_sales_outstanding(), bottom=days_inventory_outstanding(), label="sale")
                ax.bar(1, days_payable_outstanding(), bottom=days_inventory_outstanding() + days_sales_outstanding(),
                       label="payable")
                ax.set_xlim(0, 1)
                plt.ylabel('Days')
                plt.xticks([])
                plt.legend()
                plt.show()


            def profitability():
                gs = gridspec.GridSpec(2, 2)
                plt.figure()

                ax1 = plt.subplot(gs[0, 0])
                plt.pie([roa(), roa_percentage()],
                        autopct='%1.1f%%',
                        startangle=90,
                        colors=["white", "red"])
                plt.title("Return on assets")
                circle = plt.Circle((0, 0), 0.8, fc="white")
                fig = plt.gcf()
                fig.gca().add_artist(circle)

                ax2 = plt.subplot(gs[0, 1])
                plt.pie([operating_profit(), operating_profit_percetenge()],
                        autopct='%1.1f%%',
                        startangle=90,
                        colors=["white", "red"])
                plt.title("Operating profit margin")
                circle = plt.Circle((0, 0), 0.8, fc="white")
                fig = plt.gcf()
                fig.gca().add_artist(circle)

                ax3 = plt.subplot(gs[1, :])
                plt.pie([roe(), roe_percetange()],
                        autopct='%1.1f%%',
                        startangle=90,
                        colors=["white", "red"])
                plt.title("Return on equity")
                circle = plt.Circle((0, 0), 0.8, fc="white")
                fig = plt.gcf()
                fig.gca().add_artist(circle)
                plt.show()


            #Under development. Target: differentiate colors regarding the value 
            '''def Second_color():
                if roe_percetange() or operating_profit_percetenge() or roa_percentage() < 5:
                    return "red"
                elif roe_percetange or operating_profit_percetenge() or roa_percentage() > 5 and roe_percetange or operating_profit_percetenge() or roa_percentage() < 10:
                    return "yellow"
                else:
                    return "green"
            pie_chart_colors = ['white', Second_color()]'''

            while end not in ("Q", "q"):
                print(
                    "please select pics\n 1 - current ratio analysis\n 2 - capital structure\n 3 - cash conversion\n 4 - profitability")
                select_H_Main = int(input("Please enter selection"))
                if select_H_Main == 1:
                    current_ratio_pic()
                if select_H_Main == 2:
                    capital_structure()
                if select_H_Main == 3:
                    cash_conversion_cycle()
                if select_H_Main == 4:
                    profitability()
                end = input("Enter ""Q"" if you wat to go back.\n Enter any key to select other option")
                if end in ('Q','q'):
                    break
    else:
        print("Wrong choice")
